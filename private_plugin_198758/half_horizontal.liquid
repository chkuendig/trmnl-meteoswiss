<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/regular/style.css" rel="stylesheet">

<style>
  /* Material Icons Font Setup - Using Google Fonts CDN */
  .material-symbols-outlined {
    font-family: 'Material Symbols Outlined';
    font-weight: normal;
    font-style: normal;
    font-size: 24px;
    line-height: 1;
    letter-spacing: normal;
    text-transform: none;
    display: inline-block;
    white-space: nowrap;
    word-wrap: normal;
    direction: ltr;
    -webkit-font-feature-settings: 'liga';
    -webkit-font-smoothing: antialiased;
  }

  /* Weather Icon Sizes */
  .weather-icon-large {
    font-size: 60px;
  }
  .weather-icon-medium {
    font-size: 36px;
  }
  .weather-icon-small {
    font-size: 14px;
  }

  /* Weather Info Grid */
  .weather-info-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 0.5rem;
  }

  .weather-info-item {
    text-align: center;
  }

  .weather-info-item .value {
    font-size: 1.5rem;
    font-weight: bold;
  }

  .weather-info-item .label {
    font-size: 1rem;
  }

  /* Horizontal Hourly Display */
  .hourly-container {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    gap: 3px;
    padding: 5px 0 5px 5px;
    -ms-overflow-style: none;  /* Hide scrollbar IE and Edge */
    scrollbar-width: none;     /* Hide scrollbar Firefox */
  }

  /* Hide scrollbar for Chrome, Safari and Opera */
  .hourly-container::-webkit-scrollbar {
    display: none;
  }

  .hourly-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 28px;
    position: relative;
  }

  .hourly-icon {
    margin-bottom: 2px;
  }

  .hourly-temp {
    font-size: 12px;
    font-weight: bold;
    margin-bottom: 4px;
  }

  .temp-bar-vertical {
    width: 10px;
    height: 40px;
    border-radius: 5px;
    position: relative;
    margin-bottom: 4px;
  }

  .temp-indicator-vertical {
    width: 10px;
    height: 4px;
    position: absolute;
    bottom: 0;
    left: 0;
    transform: translateY(2px);
    background-color:#000;
  }

  .current-hour .temp-bar-vertical {
    background-color: #000;
    background-image: none;
  }

  .current-hour .temp-indicator-vertical {
    background-color: #fff;
  }

  .hourly-time {
    font-size: 10px;
    white-space: nowrap;
  }
</style>

{% if error %}
<!-- Error State Display for Half Horizontal Template -->
<div style="text-align: center; padding: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
  <div class="flex flex--row" style="align-items: center; justify-content: center; margin-bottom: 10px;">
    <span class="material-symbols-outlined" style="font-size: 36px; margin-right: 10px;">cloud_alert</span>
    <h4 class="title">Weather Data Unavailable</h4>
  </div>
  {% if msg %}<p style="font-size: 0.9em;">{{ msg }}</p>{% endif %}
</div>
{% else %}
<div class="flex flex--row flex--stretch p--2">
  <div class="pr--6">
    <span class="label">{{ loc.name }}</span>
    <div class="value value--large" style="position:relative; top:-12px;">
      <span class="material-symbols-outlined weather-icon-medium">
        {% case current.i %}
        {% when 'clear_day' %}wb_sunny
        {% when 'clear_night' %}dark_mode
        {% when 'partly_cloudy_day' %}partly_cloudy_day
        {% when 'partly_cloudy_night' %}nights_stay
        {% when 'cloudy' %}cloud
        {% when 'rainy' %}rainy
        {% when 'thunderstorm' %}bolt
        {% when 'snowy' %}cloudy_snowing
        {% when 'foggy' %}mist
        {% when 'error' %}error
        {% else %}device_unknown
        {% endcase %}
      </span>
      {{ current.t }}°
    </div>
    <div class="grid" style="position:relative; top:-16px;">
      {% assign tempRange = high | minus: low %}
      {% assign relativeTemp = current.t | minus: low %}
      {% if tempRange == 0 %}
      {% assign positionPercentage = 50.0 %}
      {% else %}
      {% assign positionPercentage = relativeTemp | times: 100.0 | divided_by: tempRange %}
      {% endif %}
      {% assign positionPercentage = positionPercentage | at_least: 0 | at_most: 100 %}

      <div class="label col--span-2">{{ low }}°</div>
      <div class="col--span-4 bg--gray-5 mb--0.5 mt--0.5 rounded--small" style="position: relative;">
        <div class="bg--black rounded--small" style="width: 4px; position: absolute; height: 100%; top: 0; left: calc({{ positionPercentage }}% - 2px);"></div>
      </div>
      <div class="label col--span-2 row row--center" style="text-align:right;">{{ high }}°</div>
    </div>
  </div>
  <div class="flex flex--col flex--stretch">
    <div class="grid">
      <div class="item">
        <div class="content">
          <span class="label label--small">Feels like</span>
          <span class="label">{{ current.f }}°</span>
        </div>
      </div>
      <div class="item">
        <div class=""></div>
        <div class="content">
          <span class="label label--small">Rain</span>
          <span class="label">
            {% if upcoming_rain_for_display.show_yes %}
            Yes&nbsp;<span>{{ upcoming_rain_for_display.percentage }}%</span>
            {% else %}
            No&nbsp;<span>0%</span>
            {% endif %}
          </span>
        </div>
      </div>
      <div class="item">
        <div class="content">
          <span class="label label--small">UV Index</span>
          <span class="label">{{ current.u }}&nbsp; 
            <span>
              {% if current.u <= 2 %}Low
                {% elsif current.u <= 5 %}Mid
                  {% elsif current.u <= 7 %}High
                    {% else %}Very High
                    {% endif %}
                  </span3
                  </span>
                  </div>
                  </div>
                  </div>
                    <div class="grid mb--3">

                      <div class="item">
                        <div class="content">
                          <span class="label label--small">AQI</span>
                          <span class="label">{{ aqi.value }}&nbsp;<span>{{ aqi.text }}</span></span>
                        </div>
                      </div>
                      <div class="item">
                        <div class="content">
                          <span class="label label--small">Sunrise</span>
                          <span class="label">
                            {% assign sr_time = current.sr | split: " " | first %}
                            {% assign sr_hour = sr_time | split: ":" | first | plus: 0 %}
                            {% assign sr_minute = sr_time | split: ":" | last %}
                            {{ sr_hour }}:{{ sr_minute }}&nbsp;<span>{{ current.sr | split: " " | last }}</span>
                          </span>
                        </div>
                      </div>
                      <div class="item">
                        <div class=""></div>
                        <div class="content">
                          <span class="label label--small">Sunset</span>
                          <span class="label">
                            {% assign ss_time = current.ss | split: " " | first %}
                            {% assign ss_hour = ss_time | split: ":" | first | plus: 0 %}
                            {% assign ss_minute = ss_time | split: ":" | last %}
                            {{ ss_hour }}:{{ ss_minute }}&nbsp;<span>{{ current.ss | split: " " | last }}</span>
                          </span>
                        </div>
                      </div>
                    </div>
                    </div>
                      <div class="pl--5">
                        <div id="day2">
                          <div class="grid">
                            <div class="label">
                              <span class="material-symbols-outlined weather-icon-small" style="vertical-align:middle;">
                                {% if daily[0].p > 0 %}
                                rainy
                                {% else %}
                                {% case daily[0].i %}
                                {% when 'clear_day' %}wb_sunny
                                {% when 'clear_night' %}dark_mode
                                {% when 'partly_cloudy_day' %}partly_cloudy_day
                                {% when 'partly_cloudy_night' %}nights_stay
                                {% when 'cloudy' %}cloud
                                {% when 'rainy' %}rainy
                                {% when 'thunderstorm' %}bolt
                                {% when 'snowy' %}cloudy_snowing
                                {% when 'foggy' %}mist
                                {% else %}device_unknown
                                {% endcase %}
                                {% endif %}
                              </span>
                              &nbsp;{{ daily[0].d }}
                            </div>
                            <div class="label label--small" style="text-align:right;">
                              {% if daily[0].p > 0 %}
                              {{ daily[0].p }}% 
                              {% endif %}
                            </div>
                          </div>
                          <div class="grid">
                            {% assign overallRange = overall_high | minus: overall_low %}
                            {% assign dayRange = daily[0].x | minus: daily[0].n %}
                            {% assign startRelative = daily[0].n | minus: overall_low %}

                            {% if overallRange == 0 %}
                            {% assign startPercentage = 0 %}
                            {% assign widthPercentage = 100 %}
                            {% else %}
                            {% assign startPercentage = startRelative | times: 100.0 | divided_by: overallRange %}
                            {% assign widthPercentage = dayRange | times: 100.0 | divided_by: overallRange %}
                            {% endif %}

                            {% assign startPercentage = startPercentage | at_least: 0 | at_most: 100 %}
                            {% assign widthPercentage = widthPercentage | at_least: 5 | at_most: 100 %}

                            <div class="label col--span-1">{{ daily[0].n }}°</div>
                            <div class="col--span-4 bg--gray-50 mb--0.5 mt--0.5 rounded--small" style="position: relative; overflow: hidden;">
                              <div class="bg--black" style="position: absolute; height: 100%; top: 0; left: {{ startPercentage }}%; width: {{ widthPercentage }}%;"></div>
                            </div>
                            <div class="label col--span-1" style="text-align:right;">{{ daily[0].x }}°</div>
                          </div>
                        </div>
                        <div id="day3" class="mt--2">
                          <div class="grid mb--1">
                            <div class="label">
                              <span class="material-symbols-outlined weather-icon-small" style="vertical-align:middle;">
                                {% if daily[1].p > 0 %}
                                rainy
                                {% else %}
                                {% case daily[1].i %}
                                {% when 'clear_day' %}wb_sunny
                                {% when 'clear_night' %}dark_mode
                                {% when 'partly_cloudy_day' %}partly_cloudy_day
                                {% when 'partly_cloudy_night' %}nights_stay
                                {% when 'cloudy' %}cloud
                                {% when 'rainy' %}rainy
                                {% when 'thunderstorm' %}bolt
                                {% when 'snowy' %}cloudy_snowing
                                {% when 'foggy' %}mist
                                {% else %}device_unknown
                                {% endcase %}
                                {% endif %}
                              </span>
                              &nbsp;{{ daily[1].d }}
                            </div>
                            <div class="label label--small" style="text-align:right;">
                              {% if daily[1].p > 0 %}
                              {{ daily[1].p }}% 
                              {% endif %}
                            </div>
                          </div>
                          <div class="grid">
                            {% assign overallRange = overall_high | minus: overall_low %}
                            {% assign dayRange = daily[1].x | minus: daily[1].n %}
                            {% assign startRelative = daily[1].n | minus: overall_low %}

                            {% if overallRange == 0 %}
                            {% assign startPercentage = 0 %}
                            {% assign widthPercentage = 100 %}
                            {% else %}
                            {% assign startPercentage = startRelative | times: 100.0 | divided_by: overallRange %}
                            {% assign widthPercentage = dayRange | times: 100.0 | divided_by: overallRange %}
                            {% endif %}

                            {% assign startPercentage = startPercentage | at_least: 0 | at_most: 100 %}
                            {% assign widthPercentage = widthPercentage | at_least: 5 | at_most: 100 %}

                            <div class="label col--span-1">{{ daily[1].n }}°</div>
                            <div class="col--span-4 bg--gray-50 mb--0.5 mt--0.5 rounded--small" style="position: relative; overflow: hidden;">
                              <div class="bg--black" style="position: absolute; height: 100%; top: 0; left: {{ startPercentage }}%; width: {{ widthPercentage }}%;"></div>
                            </div>
                            <div class="label col--span-1" style="text-align:right;">{{ daily[1].x }}°</div>
                          </div>
                        </div>
                      </div>
                    </div>

                      <!-- Horizontal Hourly Forecast Display -->
                      <div class="hourly-container">
                        <!-- Get current time from updated variable and convert to 24-hour format -->
                        {% assign current_time_parts = updated | strip | split: ":" %}
                        {% assign current_hour = current_time_parts[0] | strip | plus: 0 %}
                        {% assign current_ampm = current_time_parts[1] | split: " " | last | strip %}

                        <!-- Convert to 24-hour format -->
                        {% assign current_datetime = current_hour %}
                        {% if current_ampm == "PM" and current_hour != 12 %}
                        {% assign current_datetime = current_hour | plus: 12 %}
                        {% endif %}
                        {% if current_ampm == "AM" and current_hour == 12 %}
                        {% assign current_datetime = 0 %}
                        {% endif %}

                        {% for hour in hourly %}
                        {% assign tempRange = high | minus: low %}
                        {% assign relativeTemp = hour.t | minus: low %}
                        {% if tempRange == 0 %}
                        {% assign positionPercentage = 50.0 %}
                        {% else %}
                        {% assign positionPercentage = relativeTemp | times: 100.0 | divided_by: tempRange %}
                        {% endif %}
                        {% assign positionPercentage = positionPercentage | at_least: 0 | at_most: 100 %}

                        <!-- Get hour in 24-hour format for comparison -->
                        {% assign hour_parts = hour.tm | split: ":" %}
                        {% assign hour_value = hour_parts[0] | strip | plus: 0 %}
                        {% assign hour_ampm = hour.tm | split: " " | last %}
                        {% if hour_ampm == "PM" and hour_value != 12 %}
                        {% assign hour_value = hour_value | plus: 12 %}
                        {% endif %}
                        {% if hour_ampm == "AM" and hour_value == 12 %}
                        {% assign hour_value = 0 %}
                        {% endif %}

                        <!-- Check if this is the current hour -->
                        {% assign is_current_hour = false %}
                        {% if hour_value == current_datetime %}
                        {% assign is_current_hour = true %}
                        {% endif %}

                        <div class="hourly-item {% if is_current_hour %}current-hour{% endif %}">
                          <span class="material-symbols-outlined hourly-icon weather-icon-small">
                            {% case hour.i %}
                            {% when 'clear_day' %}wb_sunny
                            {% when 'clear_night' %}dark_mode
                            {% when 'partly_cloudy_day' %}partly_cloudy_day
                            {% when 'partly_cloudy_night' %}nights_stay
                            {% when 'cloudy' %}cloud
                            {% when 'rainy' %}rainy
                            {% when 'thunderstorm' %}bolt
                            {% when 'snowy' %}cloudy_snowing
                            {% when 'foggy' %}mist
                            {% when 'error' %}error
                            {% else %}device_unknown
                            {% endcase %}
                          </span>

                          <div class="hourly-temp">{{ hour.t }}°</div>

    <div class="temp-bar-vertical bg--gray-50 rounded--small">
      <div class="temp-indicator-vertical" style="bottom: {{ positionPercentage }}%;"></div>
    </div>

                          <div class="hourly-time">
                            {% assign time_parts = hour.tm | split: ":" %}
                            {% assign hour_display = time_parts[0] | strip | plus: 0 %}
                            {% assign am_pm = hour.tm | split: " " | last %}
                            {{ hour_display }}{{ am_pm }}
                          </div>
                        </div>
                        {% endfor %}
                      </div>
                    </div>
{% endif %}
