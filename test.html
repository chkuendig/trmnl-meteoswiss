<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://usetrmnl.com/css/latest/plugins.css">
    <script src="https://usetrmnl.com/js/latest/plugins.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;350;375;400;450;600;700&display=swap" rel="stylesheet">
  <!-- import Highcharts + Chartkick libraries -->
<script src="https://usetrmnl.com/js/highcharts/12.3.0/highcharts.js"></script>
<script src="https://usetrmnl.com/js/highcharts/12.3.0/pattern-fill.js"></script>
<script src="https://usetrmnl.com/js/chartkick/5.0.1/chartkick.min.js"></script>
</head>
  <body class="environment trmnl">
    {% capture mapping_json %}
{"1":{"de":"sonnig","fr":"ensoleillé","it":"soleggiato","en":"sunny","icon":"day-sunny"},"2":{"de":"ziemlich sonnig","fr":"assez ensoleillé, quelques passages nuageux","it":"abbastanza soleggiato","en":"mostly sunny, some clouds","icon":"day-sunny-overcast"},"3":{"de":"teilweise sonnig","fr":"en partie ensoleillé, passages nuageux parfois denses","it":"parzialmente soleggiato","en":"partly sunny, thick passing clouds","icon":"day-cloudy"},"4":{"de":"wechselnd bewölkt","fr":"nuageux","it":"nuvoloso","en":"overcast","icon":"day-cloudy"},"5":{"de":"bedeckt","fr":"très nuageux","it":"coperto","en":"very cloudy","icon":"cloudy"},"6":{"de":"Aufhellungen, einzelne Regenschauer","fr":"éclaircies, averses isolées","it":"nuvolosità variabile con rovesci di pioggia isolati","en":"sunny intervals, isolated showers","icon":"day-sprinkle"},"7":{"de":"Aufhellungen, einzelne Regen- oder Schneeschauer","fr":"éclaircies, averses isolées de pluie et neige mêlées","it":"nuvolosită variabile con rovesci di pioggia e neve isolati","en":"sunny intervals, isolated sleet","icon":"day-sleet"},"8":{"de":"Aufhellungen, einzelne Schneeschauer","fr":"éclaircies, giboulées de neige","it":"nuvolosità variabile con rovesci di neve isolati","en":"sunny intervals, snow showers","icon":"day-snow"},"9":{"de":"bewölkt, einige Regenschauer","fr":"nuageux, quelques averses","it":"nuvoloso con rovesci di pioggia","en":"overcast, some rain showers","icon":"day-rain"},"10":{"de":"bewölkt, einige Regen- oder Schneeschauer","fr":"nuageux, quelques averses de pluie et neige mêlées","it":"nuvoloso con rovesci di pioggia e neve","en":"overcast, some sleet","icon":"day-sleet"},"11":{"de":"bewölkt, einige Schneeschauer","fr":"nuageux, quelques averses de neige","it":"nuvoloso con rovesci di neve","en":"overcast, some snow showers","icon":"day-snow"},"12":{"de":"Aufhellungen, leicht gewitterhaft","fr":"éclaircies, faiblement orageux","it":"nuvolosită variabile, con temporali possibili","en":"sunny intervals, chance of thunderstorms","icon":"day-lightning"},"13":{"de":"Aufhellungen und gewitterhaft","fr":"éclaircies, orageux","it":"nuvolosită variabile e temporalesco","en":"sunny intervals, possible thunderstorms","icon":"day-storm-showers"},"14":{"de":"stark bewölkt, schwacher Regen","fr":"très nuageux, faibles pluies","it":"molto nuvoloso, deboli piogge","en":"very cloudy, light rain","icon":"sprinkle"},"15":{"de":"stark bewölkt, schwacher Schnee oder Regen","fr":"très nuageux, faibles chutes de pluie et neige mêlées","it":"molto nuvoloso, debole pioggia frammista a neve","en":"very cloudy, light sleet","icon":"sleet"},"16":{"de":"stark bewölkt, schwacher Schnee","fr":"très nuageux, faibles chutes de neige","it":"molto nuvoloso, deboli nevicate","en":"very cloudy, light snow showers","icon":"snow"},"17":{"de":"stark bewölkt, zeitweise Regen","fr":"très nuageux, pluies intermittentes","it":"molto nuvoloso, piogge intermittenti","en":"very cloudy, intermittent rain","icon":"showers"},"18":{"de":"stark bewölkt, zeitweise Schnee oder Regen","fr":"très nuageux, chutes intermittentes de pluie et neige mêlées","it":"molto nuvoloso, pioggia frammista a neve intermittente","en":"very cloudy, intermittent sleet","icon":"sleet"},"19":{"de":"stark bewölkt, zeitweise Schnee","fr":"très nuageux, chutes de neige intermittentes","it":"molto nuvoloso, nevicate intermittenti","en":"very cloudy, intermittent snow","icon":"snow"},"20":{"de":"stark bewölkt, anhaltender Regen","fr":"très nuageux, pluie continue","it":"molto nuvoloso, piogge intense","en":"very overcast with rain","icon":"rain"},"21":{"de":"stark bewölkt, anhaltender Regen oder Schnee","fr":"très nuageux, fréquentes chutes de pluie et neige mêlées","it":"molto nuvoloso, piogge e nevicate intense","en":"very overcast with frequent sleet","icon":"sleet"},"22":{"de":"stark bewölkt, anhaltender Schnee","fr":"très nuageux, fortes chutes de neige","it":"malto nuvoloso, nevicate intense","en":"very overcast with heavy snow","icon":"snowflake-cold"},"23":{"de":"stark bewölkt, leicht gewitterhaft","fr":"très nuageux, faiblement orageux","it":"molto nuvoloso, temporali isolati","en":"very overcast, slight chance of storms","icon":"storm-showers"},"24":{"de":"stark bewölkt, gewitterhaft","fr":"très nuageux, orageux","it":"molto nuvoloso, temporalesco","en":"very overcast with storms","icon":"storm-showers"},"25":{"de":"stark bewölkt, stark gewitterhaft","fr":"très nuageux, très orageux","it":"molto nuvoloso con temporali intensi","en":"very cloudy, very starmy","icon":"thunderstorm"},"26":{"de":"Hohe Bewölkung","fr":"nuages élevés","it":"a tratti nuvolosità ad alta quota","en":"high clouds","icon":"day-cloudy-high"},"27":{"de":"Hochnebel","fr":"stratus","it":"nebbia alta","en":"stratus","icon":"day-fog"},"28":{"de":"Nebel","fr":"brouillard","it":"nebbia","en":"fog","icon":"fog"},"29":{"de":"leicht bewölkt, einzelne Regenschauer","fr":"belles éclaircies, averses éparses","it":"in parte nuvoloso, isolati rovesci","en":"sunny intervals, scattered showers","icon":"day-showers"},"30":{"de":"leicht bewölkt, leichter Schneefall","fr":"belles éclaircies, giboulées de neige","it":"in parte nuvoloso, isolati rovesci di neve","en":"sunny intervals, scattered snow showers","icon":"day-snow"},"31":{"de":"teilweise sonnig, einige Schnee- oder Regenschauer","fr":"belles éclaircies, giboulées de pluie et de neige mêlées","it":"in parte nuvoloso, con rovesci di pioggia e di neve","en":"sunny intervals, scattered sleet","icon":"day-sleet"},"32":{"de":"teilweise sonnig, einige Regenschauer","fr":"éclaircies, quelques averses","it":"in parte nuvoloso con rovesci","en":"sunny intervals, some showers","icon":"day-showers"},"33":{"de":"bewölkt, häufige Regenschauer","fr":"rares éclaircies, fréquentes averses","it":"nuvoloso con frequenti rovesci di pioggia","en":"short sunny intervals, frequent rain","icon":"day-showers"},"34":{"de":"bewölkt, häufige Schneeschauer","fr":"rares éclaircies, fréquentes averses de neige","it":"nuvoloso con frequenti rovesci di neve","en":"short sunny intervals, frequent snowfalls","icon":"day-snow"},"35":{"de":"bedeckt und trocken","fr":"couvert et sec","it":"estesa nuvolosità ad alta quota","en":"overcast and dry","icon":"cloud"},"36":{"de":"teilweise sonnig, gewitterhaft","fr":"partiellement ensoleillé, orageux","it":"in parte nuvoloso, temporali isolati","en":"partly sunny, slightly stormy","icon":"day-lightning"},"37":{"de":"teilweise sonnig, Gewitter und Schneeschauer","fr":"partiellement ensoleillé, averses de neige orageuses","it":"in parte nuvoloso, temporali con rovesci di neve","en":"partly sunny, stormy snow showers","icon":"day-snow-thunderstorm"},"38":{"de":"bewölkt, Gewitter und häufige Regenschauer","fr":"nuageux, averses orageuses","it":"nuvoloso, temporalesco","en":"overcast, thundery showers","icon":"day-thunderstorm"},"39":{"de":"bewölkt, Gewitter und häufige Schneeschauer","fr":"nuageux, averses de neige orageuses","it":"nuvoloso, temporali con rovesci di neve","en":"overcast, thundery snow showers","icon":"day-snow-thunderstorm"},"40":{"de":"stark bewölkt, leicht gewitterhaft","fr":"très nuageux, faiblement orageux","it":"molto nuvoloso, con temporali possibili","en":"very cloudly, slightly stormy","icon":"day-lightning"},"41":{"de":"bewölkt, leicht gewitterhaft","fr":"nuageux, faiblement orageux","it":"nuvoloso, con temporali possibili","en":"overcast, slightly stormy","icon":"day-lightning"},"42":{"de":"stark bewölkt, Gewitter und häufige Schneeschauer","fr":"très nuageux, averses de neige orageuses","it":"molto nuvoloso, temporali con rovesci di neve","en":"very cloudly, thundery snow showers","icon":"day-snow-thunderstorm"},"101":{"de":"klar","fr":"ciel dégagé","it":"sereno","en":"clear","icon":"night-clear"},"102":{"de":"leicht bewölkt","fr":"peu nuageux","it":"poco nuvoloso","en":"slightly overcast","icon":"night-alt-partly-cloudy"},"103":{"de":"zum Teil bewölkt","fr":"en partie nuageux","it":"in parte nuvoloso","en":"heavy cloud formations","icon":"night-alt-cloudy"},"104":{"de":"wechselnd bewölkt","fr":"nuageux","it":"nuvoloso","en":"overcast","icon":"night-alt-cloudy"},"105":{"de":"bedeckt","fr":"très nuageux","it":"coperto","en":"very cloudy","icon":"cloudy"},"106":{"de":"Aufhellungen, einzelne Regenschauer","fr":"quelques éclaircies, averses par moments","it":"nuvolosită variabile con rovesci di pioggia isolati","en":"overcast, scattered showers","icon":"night-alt-sprinkle"},"107":{"de":"Aufhellungen, einzelne Regen- oder Schneeschauer","fr":"quelques éclaircies, par moments averses de pluie et neige mêlées","it":"nuvolosità variabile con rovesci di pioggia e neve isolati","en":"overcast, scattered rain and snow showers","icon":"night-alt-sleet"},"108":{"de":"Aufhellungen, einzelne Schneeschauer","fr":"quelques éclaircies, giboulées de neige","it":"nuvolosită variabile con rovesci di neve isolati","en":"overcast, snow showers","icon":"night-alt-snow"},"109":{"de":"bewölkt, einige Regenschauer","fr":"nuageux, quelques averses","it":"nuvoloso con rovesci di pioggia","en":"overcast, some showers.","icon":"night-alt-rain"},"110":{"de":"bewölkt, einige Regen- oder Schneeschauer","fr":"nuageux, quelques averses de pluie et neige mêlées","it":"nuvoloso con rovesci di pioggia e neve","en":"overcast, some rain and snow showers","icon":"night-alt-sleet"},"111":{"de":"bewölkt, einige Schneeschauer","fr":"nuageux, quelques averses de neige","it":"nuvoloso con rovesci di neve","en":"overcast, some snow showers.","icon":"night-alt-snow"},"112":{"de":"Aufhellungen, leicht gewitterhaft.","fr":"faiblement orageux","it":"nuvolosită variabile, con temporali possibili","en":"slightly stormy","icon":"night-alt-lightning"},"113":{"de":"Aufhellungen und gewitterhaft","fr":"orageux","it":"nuvolosită variabile e temporalesco","en":"storms","icon":"night-alt-storm-showers"},"114":{"de":"stark bewölkt, schwacher Regen","fr":"très nuageux, faibles pluies","it":"molto nuvoloso, deboli piogge","en":"very cloudy, light rain","icon":"night-alt-sprinkle"},"115":{"de":"stark bewölkt, schwacher Schnee oder Regen","fr":"très nuageux, faibles chutes de pluie et neige mêlées","it":"molto nuvoloso, debole pioggia frammista a neve","en":"very cloudy, light rain and snow showers","icon":"sleet"},"116":{"de":"stark bewölkt, schwacher Schnee","fr":"très nuageux, faibles chutes de neige","it":"molto nuvoloso, deboli nevicate","en":"very cloudy, light snowfall","icon":"night-alt-snow"},"117":{"de":"stark bewölkt, zeitweise Regen","fr":"très nuageux, pluies intermittences","it":"molto nuvoloso, piogge intermittenti","en":"very cloudy, intermittent rain","icon":"night-alt-rain"},"118":{"de":"stark bewölkt, zeitweise Schnee oder Regen","fr":"très nuageux, chutes intermittentes de pluie et neige mêlées","it":"molto nuvoloso, pioggia frammista a neve intermittente","en":"very cloudy, intermittant mixed rain and snowfall","icon":"night-alt-sleet"},"119":{"de":"stark bewölkt, zeitweise Schnee","fr":"très nuageux, chutes de neige intermittentes","it":"molto nuvoloso, nevicate intermittenti","en":"very cloudy, intermittent snowfall","icon":"night-alt-snow"},"120":{"de":"stark bewölkt, anhaltender Regen","fr":"très nuageux, pluie continue","it":"molto nuvoloso, piogge intense","en":"very cloudy, constant rain","icon":"night-alt-rain"},"121":{"de":"stark bewölkt, anhaltender Regen oder Schnee","fr":"très nuageux, fréquentes chutes de pluie et neige mêlées","it":"molto nuvoloso, piogge e nevicate intense","en":"very cloudy, frequent rain and snowfall","icon":"night-alt-sleet"},"122":{"de":"stark bewölkt, anhaltender Schnee","fr":"très nuageux, fortes chutes de neige","it":"molto nuvoloso, nevicate intense","en":"very cloudy, heavy snowfall","icon":"night-alt-snow"},"123":{"de":"stark bewölkt, leicht gewitterhaft","fr":"très nuageux, faiblement orageux","it":"molto nuvoloso, temporali isolati","en":"very cloudy, slightly stormy","icon":"night-alt-lightning"},"124":{"de":"stark bewölkt, gewitterhaft","fr":"très nuageux, orageux","it":"molto nuvoloso, temporalesco","en":"very cloudy, stormy","icon":"night-alt-thunderstorm"},"125":{"de":"stark bewölkt, stark gewitterhaft","fr":"très nuageux, très orageux","it":"molto nuvoloso con temporali intensi","en":"very cloudy, storms","icon":"night-alt-thunderstorm"},"126":{"de":"Hohe Bewölkung","fr":"nuages élevés","it":"a tratti nuvolosità ad alta quota","en":"high cloud","icon":"night-alt-cloudy-high"},"127":{"de":"Hochnebel","fr":"stratus","it":"nebbia alta","en":"stratus","icon":"night-fog"},"128":{"de":"Nebel","fr":"brouillard","it":"nebbia","en":"fog","icon":"fog"},"129":{"de":"leicht bewölkt, einzelne Regenschauer","fr":"peu nuageux, averses éparses","it":"in parte nuvoloso, isolati rovesci","en":"slightly overcast, scattered showers","icon":"night-alt-showers"},"130":{"de":"leicht bewölkt, leichter Schneefall","fr":"peu nuageux, giboulées de neige","it":"in parte nuvoloso, isolati rovesci di neve","en":"slightly overcast, scattered snowfall","icon":"night-alt-snow"},"131":{"de":"leicht bewölkt, einige Schnee- oder Regenschauer","fr":"peu nuageux, giboulées de pluie et neige mêlées","it":"in parte nuvoloso, con alcuni rovesci di pioggia e di neve","en":"slightly overcast, rain and snow showers","icon":"night-alt-sleet"},"132":{"de":"leicht bewölkt, einige Regenschauer","fr":"peu nuageux, quelques averses","it":"in parte nuvoloso con alcuni rovesci","en":"slightly overcast, some showers","icon":"night-alt-showers"},"133":{"de":"bewölkt, häufige Regenschauer","fr":"nuageux, fréquentes averses","it":"nuvoloso con frequenti rovesci di pioggia","en":"overcast, frequent snow showers","icon":"night-alt-rain"},"134":{"de":"bewölkt, häufige Schneeschauer","fr":"nuageux, fréquentes averses de neige","it":"nuvoloso con frequenti rovesci di neve","en":"overcast, frequent snow shawers","icon":"night-alt-snow"},"135":{"de":"bedeckt und trocken","fr":"couvert et sec","it":"estesa nuvolosità ad alta quota","en":"overcast and dry","icon":"cloud"},"136":{"de":"Aufhellungen, gewitterhaft","fr":"en partie nuageux, orageux","it":"in parte nuvoloso, temporali isolati","en":"slightly overcast, slightly stormy","icon":"night-alt-lightning"},"137":{"de":"leicht bewölkt, Gewitter und Schneeschauer","fr":"en partie nuageux, averses de neige orageuses","it":"in parte nuvoloso, temporali con rovesci di neve","en":"slightly overcast, stormy snow showers","icon":"night-alt-snow-thunderstorm"},"138":{"de":"bewölkt, Gewitter und häufige Regenschauer","fr":"nuageux, averses orageuses","it":"nuvoloso, temporalesco","en":"overcast, thundery showers","icon":"night-alt-thunderstorm"},"139":{"de":"bewölkt, Gewitter und häufige Schneeschauer","fr":"nuageux, averses de neige orageuses","it":"nuvoloso, temporali con rovesci di neve","en":"overcast, thundery snow showers","icon":"night-alt-snow-thunderstorm"},"140":{"de":"stark bewölkt, leicht gewitterhaft","fr":"très nuageux, faiblement orageux","it":"molto nuvoloso, con temporali possibili","en":"very cloudly, slightly stormy","icon":"night-alt-lightning"},"141":{"de":"bewölkt, leicht gewitterhaft","fr":"nuageux, faiblement orageux","it":"nuvoloso, con temporali possibili","en":"overcast, slightly stormy","icon":"night-alt-lightning"},"142":{"de":"stark bewölkt, Gewitter und häufige Schneeschauer","fr":"très nuageux, averses de neige orageuses","it":"molto nuvoloso, temporali con rovesci di neve","en":"very cloudly, thundery snow showers","icon":"night-alt-snow-thunderstorm"}}
    {% endcapture %}
    {% assign mapping = mapping_json | parse_json %}
    
    <div class="screen">
      <div class="view view--half_horizontal">
        <div class="layout">
          <div class="columns">
            <!-- Left Column: Weather Overview -->
            <div class="column" style="flex: 1 1 33.33%;">
              <div class="layout layout--col gap--space-between h--full">
                <div style="display: flex; flex-direction: column; height: 100%; flex: 1;">
                  {% assign current_icon_id = currentWeather.iconV2 | append: "" %}
                  {% assign icon_data = mapping[current_icon_id] %}
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <img src="https://usetrmnl.com/images/plugins/weather/wi-{{ icon_data.icon }}.svg" style="width: 50px; height: 50px;" alt="{{ icon_data.de }}"/>
                    <div class="value value--large">{{ currentWeather.temperature | round: 1 }}°C</div>
                  </div>
                  <div class="label" style="font-size: 12px;">{{ icon_data.en }}</div>
                  <!-- Horizontal Divider per TRMNL framework (moved above grid) -->
                  <div class="divider" style="margin-top: 8px;"></div>
                  
                  <!-- Forecast Grid (3 rows, compact, centered, bottom-aligned) -->
                  <div style="display: grid; grid-template-columns: auto auto auto auto auto; gap: 4px; margin-top: auto; padding-top: 8px; width: 60%; margin-left: auto; margin-right: auto;">
                    {% for i in (0..2) %}
                      {% assign forecast = regionForecast[i] %}
                      {% assign forecast_icon_id = forecast.iconDayV2 | append: "" %}
                      {% assign forecast_icon_data = mapping[forecast_icon_id] %}
                      {% assign date = forecast.dayDate | date: "%a" %}
                      
                      <!-- Row {{ i | plus: 1 }} -->
                      <div style="font-size: 12px; line-height: 1.1; font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">{{ date | capitalize }}</div>
                      <div style="font-size: 12px; line-height: 1.1; text-align: right; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">{{ forecast.temperatureMin }}°</div>
                      <div style="font-size: 12px; line-height: 1.1; text-align: center; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">|</div>
                      <div style="font-size: 12px; line-height: 1.1; text-align: left; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">{{ forecast.temperatureMax }}°</div>
                      <div style="display: flex; justify-content: center; align-items: center;">
                        <img src="https://usetrmnl.com/images/plugins/weather/wi-{{ forecast_icon_data.icon }}.svg" style="width: 16px; height: 16px;" alt="{{ forecast_icon_data.de }}"/>
                      </div>
                    {% endfor %}
                  </div>
                  
                </div>
              </div>
            </div>

            <!-- Right Column: Temperature Graph -->
            <div class="column" style="flex: 2 1 66.66%;">
              <div id="weather-chart" style="width: 100%; height: 100%;"></div>
            </div>
          </div>
        </div>
        
        <div class="title_bar">
          <img class="image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IB2cksfwAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAiJJREFUeNrtW7tuwzAMPAkOGuQLunTtB+T/P6nI1iUJok6uXdeW9ThZpC0BGQJD4t2JIik6Mc45B4XDGENZxx6ZvEoBmOTVCcAmr0qAEuTVCFCKvAoBSpIHgC7XcMksWpr8PwFSDI7nMMXYgrzXA3y7XBrcVuRFxoAtyQ8C3O9wzuEC4O1A5AcBbjfg+cQngI8DkR8EOJ1gAFwAvF+vcM79+czFBN9zLeQHAc5nvIzBF4Dvx+MQO/9rf3wd7sHE7mruvJrDsooajeQX64ApOHYdIIV8lTpAEvlZAVKOQegcBnn23cNq3HmmCN2SgTFgH/gQMNLcPsgDQohpJ796BHwEtZBfw9mFLhBb7MSQn9pgrR2C1caALB3tmV4VipWeBSR0lcZrrOGxtcnnHBnGmob1bpAV8KYpOIRwlvAMAUpG+xh4KTjsXsinxg+7F/Kp86xE8tX7AVvnebaYc4GU5gEpYNeKqLnnot4MpYJKDWK9HWMMvTCacukknvmxCzNE8GG3Jd1eYjMluhCqSX7JNrMy7DSmOublyda40ta4Hkd5gKSd90Xw8ffYpsqiABoqvDmyqbit5vLWV2AF9wz6LJBDXsLPjZcCY1BHKCfgSfytdUyWMACc1l1fi18hnmD3Qj41m3XY+aB3hZX+v4InwN5GE6AJ0ASQ05wonfJ26wE5m2K3NiiJfJYHSBCBgSH5LlCrQGILTxOgpcEmQBOgCaBx/AD7lBdZ6xoOogAAAABJRU5ErkJggg==" />
          {% assign plz_display = plz | divided_by: 100 %}
          <span class="title">{{ plz_display }} Zürich</span>
          {% assign current_timestamp = currentWeather.time | divided_by: 1000 %}
          <span class="instance">{{ current_timestamp | date: "%H:%M %A, %-d %B %Y" }}</span>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      // Calculate proper chart start time (last hour divisible by 3 before current time)
      var graphDataStart = {{ graph.start }};
      var currentTime = {{ currentWeather.time }};
      
      // Work with local time
      var currentDate = new Date(currentTime);
      var currentHour = currentDate.getHours();
      
      // Find the last hour divisible by 3
      var chartStartHour = Math.floor(currentHour / 3) * 3;
      
      // Create chart start time with that hour
      var chartStartDate = new Date(currentDate);
      chartStartDate.setHours(chartStartHour, 0, 0, 0);
      var chartStartTime = chartStartDate.getTime();
      
      // Calculate offset from graph data start
      var dataOffsetHours = Math.floor((chartStartTime - graphDataStart) / (1000 * 60 * 60));
      
      // Calculate how many hours since chart start
      var hoursSinceChartStart = (currentTime - chartStartTime) / (1000 * 60 * 60);
      
      // All graph data from JSON
      var allTempData = [{% for i in (0..190) %}{% if i < graph.temperatureMean1h.size %}{{ graph.temperatureMean1h[i] | round: 1 }}{% unless forloop.last %},{% endunless %}{% endif %}{% endfor %}];
      var allPrecipData = [{% for i in (0..190) %}{% if i < graph.precipitationMean1h.size %}{{ graph.precipitationMean1h[i] | round: 1 }}{% unless forloop.last %},{% endunless %}{% endif %}{% endfor %}];
      
      // Extract 24 hours of data starting from our calculated offset
      var temperatureData = [];
      var precipitationData = [];
      
      for (var i = 0; i < 24; i++) {
        var dataIndex = dataOffsetHours + i;
        if (dataIndex >= 0 && dataIndex < allTempData.length) {
          var time = new Date(chartStartTime + (i * 60 * 60 * 1000));
          var hours = String(time.getHours()).padStart(2, '0');
          var minutes = String(time.getMinutes()).padStart(2, '0');
          var timeStr = hours + ':' + minutes;
          
          temperatureData.push([timeStr, allTempData[dataIndex]]);
          precipitationData.push([timeStr, allPrecipData[dataIndex]]);
        }
      }

      var createChart = function() {
        var chart = Highcharts.chart("weather-chart", {
          chart: {
            type: "column",
            height: 220,
            animation: false,
            spacing: [34, 10, 60, 10],
            backgroundColor: "transparent"
          },
          title: { text: null },
          plotOptions: {
            series: {
              animation: false,
              enableMouseTracking: false,
              states: { hover: { enabled: false } },
              pointPadding: 0.02,
              groupPadding: 0.05,
              borderWidth: 0
            }
          },
          series: [
            {
              name: "Precipitation",
              data: precipitationData,
              type: "column",
              color: {
                pattern: {
                  image: "https://usetrmnl.com/images/grayscale/gray-3.png",
                  width: 12,
                  height: 12
                }
              },
              yAxis: 1
            },
            {
              name: "Temperature",
              data: temperatureData,
              type: "spline",
              color: "#000000",
              lineWidth: 3,
              marker: { enabled: false }
            }
          ],
          tooltip: { enabled: false },
          legend: { enabled: false },
          yAxis: [
            {
              title: { 
                text: null
              },
              labels: { 
                style: { fontSize: "14px", color: "#000000" },
                formatter: function () { return this.value + "°C"; }
              },
              gridLineDashStyle: "shortdot",
              gridLineWidth: 1,
              gridLineColor: "#000000",
              tickAmount: 5,
              minTickInterval: 5
            },
            {
              title: {
                text: null
              },
              labels: { 
                style: { fontSize: "14px", color: "#000000" },
                formatter: function () { return this.value + "mm"; }
              },
              gridLineWidth: 0,
              opposite: true
            }
          ],
          xAxis: {
            type: "category",
            tickInterval: 6,
            labels: { 
              style: { fontSize: "12px", color: "#000000" },
              y: 18
            },
            lineWidth: 0,
            gridLineDashStyle: "dot",
            tickWidth: 0,
            gridLineWidth: 1,
            gridLineColor: "#000000",
            title: { text: null },
            plotBands: [
              {
                from: -0.5,
                to: Math.max(0, hoursSinceChartStart - 0.5),
                color: {
                  pattern: {
                    image: "https://usetrmnl.com/images/grayscale/gray-5.png",
                    width: 12,
                    height: 12
                  }
                }
              }
            ]
          },
          credits: { enabled: false }
        });

        // Overlay TRMNL weather icons at every 2-hour mark
        function pickIcon(time, temp, precip) {
          var hour = parseInt(time.split(":")[0], 10);
          var night = hour < 6 || hour >= 18;
          if (precip > 0) return night ? "wi-night-alt-rain" : "wi-day-rain";
          if (night) return "wi-night-alt-cloudy";
          return "wi-day-cloudy";
        }

        var axis = chart.xAxis[0];
        var iconSize = 28;
        var topY = chart.plotTop - iconSize - 4;
        for (var i = 0; i < temperatureData.length; i += 3) {
          var t = temperatureData[i][0];
          var temp = temperatureData[i][1];
          var precip = precipitationData[i][1];
          var slug = pickIcon(t, temp, precip);
          var url = "https://usetrmnl.com/images/plugins/weather/" + slug + ".svg";
          var x = axis.toPixels(i) - iconSize / 2;
          chart.renderer.image(url, x, topY, iconSize, iconSize).add();
        }
      };

      if ("Chartkick" in window) {
        createChart();
      } else {
        window.addEventListener("chartkick:load", createChart, true);
      }
    </script>
  </body>
</html>